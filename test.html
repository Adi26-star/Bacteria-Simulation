<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ü¶† Bacteria Decomposition Simulator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Chewy&display=swap" rel="stylesheet">
<style>
:root {
  --bg-primary: #0A0E27;
  --bg-gradient-1: #1A1F3A;
  --bg-gradient-2: #0F1629;

  --neon-cyan: #00F5FF;
  --neon-pink: #FF006E;
  --neon-purple: #A855F7;
  --neon-lime: #84CC16;
  --neon-orange: #FF7518;
  --neon-yellow: #FFE100;

  --accent-cyan: #06B6D4;
  --accent-pink: #EC4899;
  --accent-purple: #9333EA;
  --accent-green: #22C55E;
  --accent-orange: #F97316;

  --text-light: #F8FAFC;
  --text-glow: #E0F2FE;
  --text-medium: #94A3B8;

  --card-bg: rgba(15, 23, 42, 0.85);
  --card-border: rgba(0, 245, 255, 0.3);
  --glow-cyan: rgba(0, 245, 255, 0.4);
  --glow-pink: rgba(255, 0, 110, 0.4);
  --glow-purple: rgba(168, 85, 247, 0.4);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Fredoka', cursive;
  background: radial-gradient(ellipse at top, #1A1F3A 0%, #0A0E27 50%, #05070F 100%);
  background-attachment: fixed;
  color: var(--text-light);
  text-align: center;
  padding: 20px;
  min-height: 100vh;
  position: relative;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image:
    radial-gradient(circle at 20% 30%, var(--glow-cyan) 0%, transparent 25%),
    radial-gradient(circle at 80% 20%, var(--glow-pink) 0%, transparent 25%),
    radial-gradient(circle at 50% 80%, var(--glow-purple) 0%, transparent 30%),
    radial-gradient(circle at 10% 70%, rgba(132, 204, 22, 0.2) 0%, transparent 20%);
  pointer-events: none;
  z-index: 0;
  animation: glowPulse 8s ease-in-out infinite;
}

@keyframes glowPulse {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 0.9; }
}

.container {
  max-width: 950px;
  margin: auto;
  position: relative;
  z-index: 1;
  animation: fadeInUp 0.6s ease-out;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.header-section {
  background: linear-gradient(135deg, rgba(0, 245, 255, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%);
  backdrop-filter: blur(10px);
  padding: 28px;
  border-radius: 20px;
  margin-bottom: 24px;
  border: 2px solid var(--card-border);
  box-shadow:
    0 0 40px var(--glow-cyan),
    0 8px 32px rgba(0, 0, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  position: relative;
  overflow: hidden;
}

.header-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0, 245, 255, 0.2), transparent);
  animation: shimmer 3s infinite;
}

@keyframes shimmer {
  0% { left: -100%; }
  100% { left: 100%; }
}

h1 {
  font-family: 'Chewy', cursive;
  font-size: 2.6rem;
  background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-pink) 50%, var(--neon-purple) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  filter: drop-shadow(0 0 20px var(--glow-cyan)) drop-shadow(0 0 30px var(--glow-pink));
  margin-bottom: 10px;
  letter-spacing: 1px;
  position: relative;
  z-index: 1;
}

.subtitle {
  font-size: 1.05rem;
  color: var(--text-glow);
  font-weight: 500;
  margin: 0;
  text-shadow: 0 0 10px rgba(0, 245, 255, 0.5);
  position: relative;
  z-index: 1;
}

.section-wrapper {
  margin-bottom: 24px;
}

.section-title {
  font-family: 'Fredoka', cursive;
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--text-light);
  margin-bottom: 14px;
  text-align: left;
  padding-left: 6px;
  display: flex;
  align-items: center;
  gap: 10px;
  text-shadow: 0 0 15px var(--glow-cyan);
  letter-spacing: 0.5px;
}

.legend {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 14px;
  padding: 20px;
  background: var(--card-bg);
  backdrop-filter: blur(10px);
  border-radius: 18px;
  font-size: 15px;
  font-weight: 600;
  border: 2px solid var(--card-border);
  box-shadow:
    0 0 30px var(--glow-cyan),
    0 8px 24px rgba(0, 0, 0, 0.4);
  animation: fadeInUp 0.5s ease-out 0.2s both;
}

.legend > div {
  padding: 10px 16px;
  background: linear-gradient(135deg, rgba(0, 245, 255, 0.15) 0%, rgba(168, 85, 247, 0.15) 100%);
  border-radius: 12px;
  border: 2px solid var(--card-border);
  box-shadow:
    0 4px 12px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  color: var(--text-light);
  cursor: default;
}

.legend > div:hover {
  transform: translateY(-4px) scale(1.05);
  box-shadow:
    0 0 25px var(--glow-cyan),
    0 8px 20px rgba(0, 0, 0, 0.4);
  border-color: var(--neon-cyan);
}

.controls {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 14px;
  padding: 22px;
  background: var(--card-bg);
  backdrop-filter: blur(10px);
  border-radius: 18px;
  border: 2px solid var(--card-border);
  box-shadow:
    0 0 30px var(--glow-purple),
    0 8px 24px rgba(0, 0, 0, 0.4);
  animation: fadeInUp 0.5s ease-out 0.3s both;
}

.control-group {
  background: linear-gradient(135deg, rgba(168, 85, 247, 0.12) 0%, rgba(0, 245, 255, 0.12) 100%);
  padding: 16px;
  border-radius: 14px;
  border: 2px solid var(--card-border);
  box-shadow:
    0 4px 16px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.control-group::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0, 245, 255, 0.15), transparent);
  transition: left 0.5s;
}

.control-group:hover::before {
  left: 100%;
}

.control-group:hover {
  transform: translateY(-5px) scale(1.02);
  box-shadow:
    0 0 30px var(--glow-cyan),
    0 10px 25px rgba(0, 0, 0, 0.4);
  border-color: var(--neon-cyan);
}

.control-group label {
  display: block;
  font-weight: 700;
  font-size: 12px;
  margin-bottom: 10px;
  color: var(--text-light);
  text-transform: uppercase;
  letter-spacing: 1px;
  text-shadow: 0 0 10px var(--glow-cyan);
  position: relative;
  z-index: 1;
}

.control-group input[type="range"] {
  width: 100%;
  height: 10px;
  border-radius: 10px;
  background: linear-gradient(to right, var(--neon-pink), var(--neon-purple), var(--neon-cyan));
  outline: none;
  border: 2px solid rgba(0, 245, 255, 0.3);
  -webkit-appearance: none;
  cursor: pointer;
  box-shadow:
    0 0 15px var(--glow-cyan),
    inset 0 1px 3px rgba(0, 0, 0, 0.4);
  position: relative;
  z-index: 1;
}

.control-group input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-purple) 100%);
  border: 3px solid rgba(15, 23, 42, 0.9);
  cursor: grab;
  box-shadow:
    0 0 20px var(--glow-cyan),
    0 4px 12px rgba(0, 0, 0, 0.5);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.control-group input[type="range"]::-webkit-slider-thumb:hover {
  transform: scale(1.25);
  background: linear-gradient(135deg, var(--neon-yellow) 0%, var(--neon-orange) 100%);
  box-shadow:
    0 0 30px var(--neon-yellow),
    0 6px 16px rgba(0, 0, 0, 0.6);
}

.control-group input[type="range"]::-webkit-slider-thumb:active {
  cursor: grabbing;
  transform: scale(1.15);
  box-shadow:
    0 0 25px var(--neon-pink),
    0 4px 12px rgba(0, 0, 0, 0.5);
}

.control-group input[type="range"]::-moz-range-thumb {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--neon-purple) 100%);
  border: 3px solid rgba(15, 23, 42, 0.9);
  cursor: grab;
  box-shadow:
    0 0 20px var(--glow-cyan),
    0 4px 12px rgba(0, 0, 0, 0.5);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.control-group input[type="range"]::-moz-range-thumb:hover {
  transform: scale(1.25);
  background: linear-gradient(135deg, var(--neon-yellow) 0%, var(--neon-orange) 100%);
  box-shadow:
    0 0 30px var(--neon-yellow),
    0 6px 16px rgba(0, 0, 0, 0.6);
}

.value-display {
  display: inline-block;
  margin-top: 10px;
  padding: 8px 16px;
  background: linear-gradient(135deg, rgba(0, 245, 255, 0.2) 0%, rgba(168, 85, 247, 0.2) 100%);
  border-radius: 10px;
  border: 2px solid var(--neon-cyan);
  font-weight: 800;
  font-size: 18px;
  color: var(--neon-cyan);
  box-shadow:
    0 0 20px var(--glow-cyan),
    0 4px 12px rgba(0, 0, 0, 0.4);
  min-width: 60px;
  text-shadow: 0 0 10px var(--glow-cyan);
  position: relative;
  z-index: 1;
  animation: valueGlow 2s ease-in-out infinite;
}

@keyframes valueGlow {
  0%, 100% {
    box-shadow:
      0 0 20px var(--glow-cyan),
      0 4px 12px rgba(0, 0, 0, 0.4);
  }
  50% {
    box-shadow:
      0 0 30px var(--glow-cyan),
      0 6px 16px rgba(0, 0, 0, 0.5);
  }
}

.timer-display {
  background: linear-gradient(135deg, rgba(255, 0, 110, 0.15) 0%, rgba(132, 204, 22, 0.15) 100%);
  padding: 16px;
  border-radius: 14px;
  border: 2px solid var(--card-border);
  box-shadow:
    0 0 25px var(--glow-pink),
    0 4px 16px rgba(0, 0, 0, 0.3);
  text-align: center;
  font-weight: 600;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  z-index: 1;
}

.timer-display .label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 6px;
  color: var(--text-glow);
  text-shadow: 0 0 8px var(--glow-cyan);
}

.timer-display .time {
  font-size: 22px;
  font-weight: 800;
  background: linear-gradient(135deg, var(--neon-lime) 0%, var(--neon-yellow) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  filter: drop-shadow(0 0 15px var(--neon-lime));
}

#restartBtn {
  background: linear-gradient(135deg, var(--neon-orange) 0%, var(--neon-pink) 100%);
  border: 3px solid rgba(255, 0, 110, 0.5);
  border-radius: 14px;
  padding: 16px 20px;
  font-size: 26px;
  cursor: pointer;
  box-shadow:
    0 0 30px var(--glow-pink),
    0 6px 20px rgba(0, 0, 0, 0.4);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  font-family: 'Fredoka', cursive;
  color: white;
  font-weight: 700;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
  position: relative;
  overflow: hidden;
}

#restartBtn::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

#restartBtn:hover::before {
  width: 300px;
  height: 300px;
}

#restartBtn:hover {
  transform: translateY(-5px) rotate(180deg) scale(1.1);
  box-shadow:
    0 0 50px var(--neon-pink),
    0 10px 30px rgba(0, 0, 0, 0.5);
  border-color: var(--neon-yellow);
}

#restartBtn:active {
  transform: translateY(-2px) rotate(180deg) scale(1.05);
  box-shadow:
    0 0 40px var(--glow-pink),
    0 6px 20px rgba(0, 0, 0, 0.4);
}

.canvas-wrapper {
  position: relative;
  display: inline-block;
  margin-top: 24px;
  animation: fadeInUp 0.5s ease-out 0.4s both;
}

canvas {
  background: linear-gradient(180deg, rgba(10, 14, 39, 0.6) 0%, rgba(15, 22, 41, 0.8) 100%);
  border-radius: 20px;
  border: 3px solid var(--card-border);
  box-shadow:
    0 0 50px var(--glow-purple),
    0 12px 40px rgba(0, 0, 0, 0.6),
    inset 0 0 60px rgba(0, 245, 255, 0.1);
  display: block;
}

.fun-badge {
  position: absolute;
  top: -15px;
  right: -15px;
  background: linear-gradient(135deg, var(--neon-yellow) 0%, var(--neon-orange) 50%, var(--neon-pink) 100%);
  border: 3px solid rgba(15, 23, 42, 0.9);
  border-radius: 50%;
  width: 70px;
  height: 70px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  box-shadow:
    0 0 40px var(--neon-yellow),
    0 8px 20px rgba(0, 0, 0, 0.5);
  animation: badgeSpin 15s linear infinite, badgePulse 2s ease-in-out infinite;
  z-index: 10;
}

@keyframes badgeSpin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes badgePulse {
  0%, 100% {
    box-shadow:
      0 0 40px var(--neon-yellow),
      0 8px 20px rgba(0, 0, 0, 0.5);
  }
  50% {
    box-shadow:
      0 0 60px var(--neon-orange),
      0 12px 30px rgba(0, 0, 0, 0.6);
  }
}

.floating-particles {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
}

.particle {
  position: absolute;
  font-size: 24px;
  animation: float 18s infinite ease-in-out;
  opacity: 0.4;
  filter: drop-shadow(0 0 8px var(--glow-cyan));
}

.particle:nth-child(1) {
  left: 10%;
  animation-delay: 0s;
  animation-duration: 16s;
}
.particle:nth-child(2) {
  left: 20%;
  animation-delay: 3s;
  animation-duration: 18s;
  filter: drop-shadow(0 0 8px var(--glow-pink));
}
.particle:nth-child(3) {
  left: 30%;
  animation-delay: 6s;
  animation-duration: 17s;
  filter: drop-shadow(0 0 8px var(--glow-purple));
}
.particle:nth-child(4) {
  left: 70%;
  animation-delay: 2s;
  animation-duration: 19s;
  filter: drop-shadow(0 0 8px var(--glow-cyan));
}
.particle:nth-child(5) {
  left: 80%;
  animation-delay: 5s;
  animation-duration: 20s;
  filter: drop-shadow(0 0 8px var(--neon-lime));
}
.particle:nth-child(6) {
  left: 90%;
  animation-delay: 8s;
  animation-duration: 18s;
  filter: drop-shadow(0 0 8px var(--neon-yellow));
}

@keyframes float {
  0%, 100% {
    transform: translateY(100vh) rotate(0deg);
    opacity: 0;
  }
  10% {
    opacity: 0.4;
  }
  90% {
    opacity: 0.4;
  }
  100% {
    transform: translateY(-100px) rotate(180deg);
    opacity: 0;
  }
}

</style>
</head>

<body>
<div class="floating-particles">
  <div class="particle">ü¶†</div>
  <div class="particle">üß¨</div>
  <div class="particle">‚öóÔ∏è</div>
  <div class="particle">üî¨</div>
  <div class="particle">üß™</div>
  <div class="particle">üíß</div>
</div>

<div class="container">
<div class="header-section">
  <h1>ü¶† Bacteria Decomposition Simulator üß™</h1>
  <div class="subtitle">Interactive Model: How Microorganisms Break Down Plastic Waste</div>
</div>

<div class="section-wrapper">
  <h2 class="section-title">üìä Simulation Status</h2>
  <div class="legend">
    <div>üü¢ Bacteria Swarm</div>
    <div>üü£ Enzymes</div>
    <div>üî∑ Plastic: <span id="plasticCount"></span></div>
    <div>üí™ Remaining: <span id="plasticRemaining"></span>%</div>
  </div>
</div>

<div class="section-wrapper">
  <h2 class="section-title">üéõÔ∏è Simulation Controls</h2>
  <div class="controls">
  <div class="control-group">
    <label>ü¶† Bacteria Count</label>
    <input type="range" id="bacteriaSlider" min="4" max="40" value="14">
    <div class="value-display"><span id="bacteriaVal">14</span></div>
  </div>

  <div class="control-group">
    <label>üî∑ Plastic Pieces</label>
    <input type="range" id="plasticSlider" min="6" max="50" value="24">
    <div class="value-display"><span id="plasticVal">24</span></div>
  </div>

  <div class="control-group">
    <label>üå°Ô∏è Temperature (¬∞C)</label>
    <input type="range" id="tempSlider" min="0" max="75" value="25">
    <div class="value-display"><span id="tempVal">25</span>¬∞C</div>
  </div>

  <div class="control-group">
    <label>üíß Moisture Level</label>
    <input type="range" id="moistureSlider" min="0" max="1" step="0.1" value="1">
    <div class="value-display"><span id="moistureVal">1</span></div>
  </div>

  <div class="timer-display">
    <div class="label">‚è±Ô∏è Elapsed Time</div>
    <div class="time"><span id="elapsedTime">0 d 0 h</span></div>
  </div>

  <button id="restartBtn" type="button" aria-label="Restart simulation" title="Restart simulation">üîÑ</button>
  </div>
</div>

<div class="section-wrapper">
  <h2 class="section-title">üî¨ Live Simulation View</h2>
  <div class="canvas-wrapper">
    <div class="fun-badge">üî¨</div>
    <canvas id="scene" width="850" height="420"></canvas>
  </div>
</div>
</div>

<script>
const canvas = document.getElementById("scene");
const ctx = canvas.getContext("2d");

const plasticCountEl = document.getElementById("plasticCount");
const plasticRemainingEl = document.getElementById("plasticRemaining");
const bacteriaSlider = document.getElementById("bacteriaSlider");
const plasticSlider = document.getElementById("plasticSlider");
const bacteriaVal = document.getElementById("bacteriaVal");
const plasticVal = document.getElementById("plasticVal");
const tempSlider = document.getElementById("tempSlider");
const tempVal = document.getElementById("tempVal");
const moistureSlider = document.getElementById("moistureSlider");
const moistureVal = document.getElementById("moistureVal");
const elapsedTimeEl = document.getElementById("elapsedTime");
const restartBtn = document.getElementById("restartBtn");

const groundY = 300;
const plastics = [];
const bacteriaSwarm = [];
const enzymes = [];
let enzymeCooldown = 0;
let lastTimestamp = 0;
let secondAccumulator = 0;
let simulationActive = true;
let timerStarted = false;
let elapsedStart = 0;
const secondDurationMs = 1000;
const simulationSpeed = 1.5;

function rand(min, max) {
  return min + Math.random() * (max - min);
}

function createPlastics() {
  plastics.length = 0;
  const totalPlasticPieces = Number(plasticSlider.value);
  for (let i = 0; i < totalPlasticPieces; i++) {
    const x = rand(90, canvas.width - 90);
    const y = rand(groundY - 60, groundY + 40);
    const size = rand(18, 36);
    plastics.push({
      x,
      y,
      size,
      integrity: 100,
      wobble: rand(0, Math.PI * 2)
    });
  }
}

function createBacteria() {
  bacteriaSwarm.length = 0;
  const bacteriaCount = Number(bacteriaSlider.value);
  for (let i = 0; i < bacteriaCount; i++) {
    bacteriaSwarm.push({
      x: rand(80, canvas.width - 80),
      y: rand(80, groundY - 40),
      radius: rand(6, 10),
      speed: rand(0.6, 1.2),
      wiggle: rand(0, Math.PI * 2)
    });
  }
}

function tempFactor() {
  const tempC = Number(tempSlider.value);
  if (tempC < 5 || tempC > 70) {
    return 0;
  }
  return 0.5 + (tempC / 75);
}

function moistureFactor() {
  return Number(moistureSlider.value);
}

function nearestPlastic(b) {
  let closest = null;
  let closestDist = Infinity;
  for (const p of plastics) {
    if (p.integrity <= 0) continue;
    const dx = p.x - b.x;
    const dy = p.y - b.y;
    const dist = Math.hypot(dx, dy);
    if (dist < closestDist) {
      closestDist = dist;
      closest = p;
    }
  }
  return { target: closest, dist: closestDist };
}

function spawnEnzymes() {
  if (tempFactor() === 0) {
    return;
  }
  if (enzymeCooldown > 0) {
    enzymeCooldown -= 1;
    return;
  }
  for (const b of bacteriaSwarm) {
    if (Math.random() < 0.35) {
      enzymes.push({
        x: b.x,
        y: b.y,
        radius: rand(3, 5),
        speed: rand(1.2, 2.2),
        life: rand(140, 220),
        drift: rand(0, Math.PI * 2)
      });
    }
  }
  enzymeCooldown = 10;
}

function updateEnzymes() {
  const factor = tempFactor();
  const moisture = moistureFactor();
  for (const e of enzymes) {
    const { target } = nearestPlastic(e);
    if (target) {
      const dx = target.x - e.x;
      const dy = target.y - e.y;
      const angle = Math.atan2(dy, dx);
      const step = e.speed * factor * moisture * simulationSpeed;
      e.x += Math.cos(angle) * step;
      e.y += Math.sin(angle) * step;

      if (Math.hypot(dx, dy) < e.radius + target.size * 0.35) {
        target.integrity = Math.max(0, target.integrity - 0.6 * factor * moisture * simulationSpeed);
        e.life -= 40;
      }
    } else {
      e.drift += 0.2;
      e.x += Math.cos(e.drift) * 0.6;
      e.y += Math.sin(e.drift) * 0.6;
    }
    e.life -= 1;
  }
  for (let i = enzymes.length - 1; i >= 0; i--) {
    if (enzymes[i].life <= 0) enzymes.splice(i, 1);
  }
}

function updateBacteria() {
  const factor = tempFactor();
  const moisture = moistureFactor();
  for (const b of bacteriaSwarm) {
    const { target, dist } = nearestPlastic(b);
    if (target) {
      const dx = target.x - b.x;
      const dy = target.y - b.y;
      const angle = Math.atan2(dy, dx);
      const step = b.speed * factor * moisture * simulationSpeed;
      b.x += Math.cos(angle) * step;
      b.y += Math.sin(angle) * step;
    }

    b.wiggle += 0.1;
    b.y += Math.sin(b.wiggle) * 0.3;
  }
}

function drawBackground() {
  // Sky with fun gradient
  const sky = ctx.createLinearGradient(0, 0, 0, groundY);
  sky.addColorStop(0, "#B4E7FF");
  sky.addColorStop(0.5, "#E0BBE4");
  sky.addColorStop(1, "#FFD6E8");
  ctx.fillStyle = sky;
  ctx.fillRect(0, 0, canvas.width, groundY);

  // Add floating bubbles in background
  ctx.fillStyle = "rgba(255, 255, 255, 0.3)";
  for (let i = 0; i < 15; i++) {
    const x = (i * 60 + Date.now() * 0.01) % canvas.width;
    const y = (i * 40 + Math.sin(Date.now() * 0.001 + i) * 30) % groundY;
    const size = 8 + (i % 3) * 4;
    ctx.beginPath();
    ctx.arc(x, y, size, 0, Math.PI * 2);
    ctx.fill();
  }

  // Landfill mound with cartoon style
  const mound = ctx.createLinearGradient(0, groundY - 80, 0, canvas.height);
  mound.addColorStop(0, "#8B7355");
  mound.addColorStop(0.5, "#6B5444");
  mound.addColorStop(1, "#4A3B2F");
  ctx.fillStyle = mound;

  // Outline first (comic book style)
  ctx.strokeStyle = "#2D1B13";
  ctx.lineWidth = 6;
  ctx.beginPath();
  ctx.moveTo(0, groundY);
  ctx.bezierCurveTo(140, groundY - 90, 320, groundY - 40, 520, groundY - 70);
  ctx.bezierCurveTo(650, groundY - 90, 760, groundY - 10, canvas.width, groundY - 40);
  ctx.lineTo(canvas.width, canvas.height);
  ctx.lineTo(0, canvas.height);
  ctx.closePath();
  ctx.stroke();
  ctx.fill();

  // Add texture spots
  ctx.fillStyle = "rgba(0, 0, 0, 0.15)";
  for (let i = 0; i < 20; i++) {
    const x = Math.random() * canvas.width;
    const y = groundY + Math.random() * (canvas.height - groundY);
    const size = 3 + Math.random() * 8;
    ctx.beginPath();
    ctx.arc(x, y, size, 0, Math.PI * 2);
    ctx.fill();
  }
}

function drawPlastics() {
  for (const p of plastics) {
    if (p.integrity <= 0) continue;
    const size = p.size * (0.4 + p.integrity / 200);
    const alpha = Math.max(0.2, p.integrity / 100);
    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(Math.sin(p.wobble) * 0.3);

    // Cartoon outline
    ctx.strokeStyle = `rgba(14, 76, 100, ${alpha})`;
    ctx.lineWidth = 4;
    drawRoundedRect(-size / 2, -size / 3, size, size / 1.6, 8);
    ctx.stroke();

    // Gradient fill
    const gradient = ctx.createLinearGradient(-size/2, -size/3, size/2, size/1.6);
    gradient.addColorStop(0, `rgba(76, 201, 240, ${alpha})`);
    gradient.addColorStop(0.5, `rgba(56, 189, 248, ${alpha})`);
    gradient.addColorStop(1, `rgba(30, 170, 230, ${alpha})`);
    ctx.fillStyle = gradient;
    drawRoundedRect(-size / 2, -size / 3, size, size / 1.6, 8);
    ctx.fill();

    // Shine effect
    ctx.fillStyle = `rgba(255, 255, 255, ${alpha * 0.5})`;
    ctx.beginPath();
    ctx.ellipse(-size / 4, -size / 6, size / 6, size / 10, -0.3, 0, Math.PI * 2);
    ctx.fill();

    ctx.restore();
    p.wobble += 0.02;
  }
}

function drawRoundedRect(x, y, width, height, radius) {
  const r = Math.min(radius, width / 2, height / 2);
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + width - r, y);
  ctx.quadraticCurveTo(x + width, y, x + width, y + r);
  ctx.lineTo(x + width, y + height - r);
  ctx.quadraticCurveTo(x + width, y + height, x + width - r, y + height);
  ctx.lineTo(x + r, y + height);
  ctx.quadraticCurveTo(x, y + height, x, y + height - r);
  ctx.lineTo(x, y + r);
  ctx.quadraticCurveTo(x, y, x + r, y);
  ctx.closePath();
}

function drawEnzymes() {
  const dormant = tempFactor() === 0;
  for (const e of enzymes) {
    ctx.save();
    ctx.translate(e.x, e.y);

    // Glow effect
    if (!dormant) {
      const glow = ctx.createRadialGradient(0, 0, 0, 0, 0, e.radius * 2);
      glow.addColorStop(0, "rgba(168, 85, 247, 0.4)");
      glow.addColorStop(1, "rgba(168, 85, 247, 0)");
      ctx.fillStyle = glow;
      ctx.beginPath();
      ctx.arc(0, 0, e.radius * 2, 0, Math.PI * 2);
      ctx.fill();
    }

    // Main body with gradient
    const gradient = ctx.createRadialGradient(-e.radius/3, -e.radius/3, 0, 0, 0, e.radius);
    if (dormant) {
      gradient.addColorStop(0, "rgba(180, 190, 200, 0.9)");
      gradient.addColorStop(1, "rgba(120, 130, 150, 0.7)");
    } else {
      gradient.addColorStop(0, "rgba(200, 120, 255, 0.9)");
      gradient.addColorStop(1, "rgba(140, 60, 220, 0.8)");
    }
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(0, 0, e.radius, 0, Math.PI * 2);
    ctx.fill();

    // Cartoon outline
    ctx.strokeStyle = dormant ? "rgba(70, 80, 100, 1)" : "rgba(100, 30, 180, 1)";
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    ctx.arc(0, 0, e.radius, 0, Math.PI * 2);
    ctx.stroke();

    // Sparkle
    if (!dormant) {
      ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
      ctx.beginPath();
      ctx.arc(-e.radius/3, -e.radius/3, e.radius/4, 0, Math.PI * 2);
      ctx.fill();
    }

    ctx.restore();
  }
}

function drawBacteria() {
  const dormant = tempFactor() === 0;
  for (const b of bacteriaSwarm) {
    ctx.save();
    ctx.translate(b.x, b.y);

    // Flagella (cartoon wiggly tails)
    ctx.strokeStyle = dormant ? "rgba(120, 140, 160, 0.8)" : "rgba(30, 200, 100, 0.9)";
    ctx.lineWidth = 3;
    ctx.lineCap = "round";
    for (let i = 0; i < 4; i++) {
      const angle = (i / 4) * Math.PI * 2 + b.wiggle * 0.2;
      ctx.beginPath();
      ctx.moveTo(Math.cos(angle) * b.radius * 0.6, Math.sin(angle) * b.radius * 0.4);

      // Wavy flagella
      const segments = 3;
      for (let s = 1; s <= segments; s++) {
        const dist = (b.radius * 1.6 / segments) * s;
        const wave = Math.sin(b.wiggle + s) * 4;
        const px = Math.cos(angle) * dist + Math.cos(angle + Math.PI/2) * wave;
        const py = Math.sin(angle) * dist * 0.7 + Math.sin(angle + Math.PI/2) * wave;
        ctx.lineTo(px, py);
      }
      ctx.stroke();
    }

    // Main body with gradient
    const gradient = ctx.createRadialGradient(-b.radius/2, -b.radius/2, 0, 0, 0, b.radius * 1.5);
    if (dormant) {
      gradient.addColorStop(0, "#B4C4D8");
      gradient.addColorStop(1, "#7A8AA0");
    } else {
      gradient.addColorStop(0, "#4ADE80");
      gradient.addColorStop(1, "#16A34A");
    }
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.ellipse(0, 0, b.radius * 1.2, b.radius * 0.9, 0, 0, Math.PI * 2);
    ctx.fill();

    // Cartoon outline
    ctx.strokeStyle = dormant ? "#506070" : "#0F7A2F";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.ellipse(0, 0, b.radius * 1.2, b.radius * 0.9, 0, 0, Math.PI * 2);
    ctx.stroke();

    // Eyes (cute!)
    ctx.fillStyle = dormant ? "#506070" : "#0F7A2F";
    ctx.beginPath();
    ctx.arc(-b.radius * 0.4, -b.radius * 0.2, b.radius * 0.2, 0, Math.PI * 2);
    ctx.arc(b.radius * 0.4, -b.radius * 0.2, b.radius * 0.2, 0, Math.PI * 2);
    ctx.fill();

    // Eye shine
    ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
    ctx.beginPath();
    ctx.arc(-b.radius * 0.4 - b.radius * 0.08, -b.radius * 0.25, b.radius * 0.08, 0, Math.PI * 2);
    ctx.arc(b.radius * 0.4 - b.radius * 0.08, -b.radius * 0.25, b.radius * 0.08, 0, Math.PI * 2);
    ctx.fill();

    // Happy mouth
    if (!dormant) {
      ctx.strokeStyle = "#0F7A2F";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(0, b.radius * 0.1, b.radius * 0.5, 0.2, Math.PI - 0.2);
      ctx.stroke();
    }

    // Highlight
    ctx.fillStyle = "rgba(255, 255, 255, 0.4)";
    ctx.beginPath();
    ctx.ellipse(-b.radius * 0.3, -b.radius * 0.3, b.radius * 0.5, b.radius * 0.3, -0.5, 0, Math.PI * 2);
    ctx.fill();

    ctx.restore();
  }
}

function updateStats() {
  const remainingPieces = plastics.filter(p => p.integrity > 0).length;
  const totalIntegrity = plastics.reduce((sum, p) => sum + p.integrity, 0);
  const totalPlasticPieces = Number(plasticSlider.value);
  const percent = totalPlasticPieces === 0
    ? 0
    : Math.max(0, Math.round((totalIntegrity / (totalPlasticPieces * 100)) * 100));
  plasticCountEl.textContent = percent === 0 ? 0 : remainingPieces;
  plasticRemainingEl.textContent = percent;
  return percent;
}

function drawScene() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawBackground();
  drawPlastics();
  drawEnzymes();
  drawBacteria();

  // Victory message when plastic reaches 0%
  const totalIntegrity = plastics.reduce((sum, p) => sum + p.integrity, 0);
  const totalPlasticPieces = Number(plasticSlider.value);
  const percent = totalPlasticPieces === 0
    ? 0
    : Math.max(0, Math.round((totalIntegrity / (totalPlasticPieces * 100)) * 100));

  if (percent === 0 && plastics.length > 0 && timerStarted) {
    ctx.save();
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    // Celebration text with neon glow effect
    ctx.font = "bold 56px 'Fredoka'";
    ctx.shadowColor = "rgba(0, 245, 255, 0.8)";
    ctx.shadowBlur = 30;
    ctx.fillStyle = "#00F5FF";
    ctx.fillText("üéâ ALL CLEAN! üéâ", canvas.width / 2, canvas.height / 2 - 35);

    ctx.font = "bold 36px 'Fredoka'";
    ctx.shadowColor = "rgba(255, 0, 110, 0.8)";
    ctx.shadowBlur = 25;
    ctx.fillStyle = "#FF006E";
    ctx.fillText("BACTERIA WIN!", canvas.width / 2, canvas.height / 2 + 25);

    ctx.restore();
  }
}

function updateTimer(timestamp, remainingPercent) {
  if (!simulationActive) return;
  if (!timerStarted && remainingPercent === 100) {
    timerStarted = true;
    lastTimestamp = timestamp;
    elapsedStart = timestamp;
  }
  if (!timerStarted) return;
  if (remainingPercent <= 0) {
    simulationActive = false;
    return;
  }
  if (!lastTimestamp) lastTimestamp = timestamp;
  const delta = timestamp - lastTimestamp;
  lastTimestamp = timestamp;
  secondAccumulator += delta;
  while (secondAccumulator >= secondDurationMs) {
    secondAccumulator -= secondDurationMs;
  }
  const timeScale = 1 / 3;
  const elapsedDays = ((timestamp - elapsedStart) / 1000) * timeScale;
  const wholeDays = Math.floor(elapsedDays);
  const hours = Math.floor((elapsedDays - wholeDays) * 24);
  elapsedTimeEl.textContent = `${wholeDays} d ${hours} h`;
}

function loop(timestamp) {
  if (!timerStarted) {
    drawScene();
    const remainingPercent = updateStats();
    updateTimer(timestamp, remainingPercent);
    requestAnimationFrame(loop);
    return;
  }
  if (simulationActive) {
    spawnEnzymes();
    updateBacteria();
    updateEnzymes();
  }
  drawScene();
  const remainingPercent = updateStats();
  updateTimer(timestamp, remainingPercent);
  requestAnimationFrame(loop);
}

function updateCounts() {
  bacteriaVal.textContent = bacteriaSlider.value;
  plasticVal.textContent = plasticSlider.value;
  tempVal.textContent = tempSlider.value;
  moistureVal.textContent = moistureSlider.value;
}

function resetSimulation() {
  createPlastics();
  createBacteria();
  enzymes.length = 0;
  enzymeCooldown = 0;
  secondAccumulator = 0;
  lastTimestamp = 0;
  simulationActive = true;
  timerStarted = false;
  elapsedStart = 0;
  elapsedTimeEl.textContent = "0 d 0 h";
}

bacteriaSlider.addEventListener("input", () => {
  updateCounts();
  createBacteria();
});

plasticSlider.addEventListener("input", () => {
  updateCounts();
  resetSimulation();
});

tempSlider.addEventListener("input", () => {
  updateCounts();
});

moistureSlider.addEventListener("input", () => {
  updateCounts();
});

updateCounts();
resetSimulation();
loop();

restartBtn.addEventListener("click", () => {
  resetSimulation();
});
</script>
</body>
</html>
